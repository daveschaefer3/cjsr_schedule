<html>
<head>
  <meta charset="UTF-8">
  <title>CJSR Program Schedule</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css">
  <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">
  <link rel="stylesheet/less" type="text/css" href="css/schedule.less" />

  <script type="text/javascript" src="javascripts/lib/jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="javascripts/lib/handlebars-1.0.0.js"></script>
  <script type="text/javascript" src="javascripts/lib/json2.js"></script>

  <script type="text/javascript" src="javascripts/showJson.js"></script>
  <script type="text/javascript" src="javascripts/templateHelpers.js"></script>
  <script type="text/javascript">
    // custom Handlebars template helpers

    Handlebars.registerHelper("");
  </script>

  <script type="text/javascript">
    // template filling
    
    $(function(){

      
      // 
      // $('#days-box').append(JSON.stringify(showJson));

      var shows = showJson.shows;
      var dayList = [
        {theDay: "sun", fullDay: "Sunday"},
        {theDay: "mon", fullDay: "Monday"},
        {theDay: "tues", fullDay: "Tuesday"},
        {theDay: "wed", fullDay: "Wednesday"},
        {theDay: "thurs", fullDay: "Thursday"},
        {theDay: "fri", fullDay: "Friday"},
        {theDay: "sat", fullDay: "Saturday"}
      ];

      for(var i=0; i < 24; i++) {
        var timeBlock = "";
        var iPlus = (i + 6);
        var iMinus = (i - 6);
        var jMinus = (i - 18);
        if (i <= 6) {
          timeBlock += '<div class="timeBlock ' + iPlus + '00">';
          timeBlock += iPlus + ':00' + ((i==6) ? 'PM' : 'AM');
          timeBlock += '</div><div class="timeBlock ';
          timeBlock += iPlus + '30">' + iPlus + ':30';
          timeBlock += ((i==6) ? 'PM' : 'AM') +'</div>';
        } else {
          timeBlock += '<div class="timeBlock ';
          timeBlock += ((iPlus < 24) ? iPlus : jMinus) + '00">';
          timeBlock += ((iMinus > 12) ? jMinus : iMinus) + ':00';
          timeBlock += ((iMinus >= 12) ? 'AM' : 'PM'); 
          timeBlock += '</div><div class="timeBlock ';
          timeBlock += ((iPlus < 24) ? iPlus : jMinus) + '30">';
          timeBlock += ((iMinus > 12) ? jMinus : iMinus) + ':30';
          timeBlock += ((iMinus >= 12) ? 'AM' : 'PM') + '</div>';
        }

        $('.timestrip').append(timeBlock);
      };

      var daySource = $('#day-template').html();
      var showSource = $('#show-template').html();


      // DAY TEMPLATING
      for (var i=0; i < dayList.length; i++) {
        var dayTemplate = Handlebars.compile(daySource);
        var dayHtml = dayTemplate(dayList[i]);
        $('#days-box').append(dayHtml);
      };
      // set the height for .day to the height of .timestrip
      var boxHeight = $('.timestrip').height();
      $('.day').height(boxHeight);


      // The absolute top of each show block needs to be determined by one equation/algorithm. 
      // Each timeBlock is 20px so a 1 hour show is 40px tall and a 2 hour block is 80px tall.
      // Shows that start at 600 should have an absolute top of zero.
      // shows that start at 1300 should have a top of 280px (40px * 7 hours?)

      // SHOW TEMPLATING

      for (var n=0; n < shows.length; n++) {
        var show = shows[n];
        var columnDump = "#" + show.day;

        // test code
        var topPosition, startVar;
        if (show.start < 600) {
          startVar = show.start + 1800;
        } else {
          startVar = show.start - 600;
        };
        topPosition = startVar;

        var showTemplate = Handlebars.compile(showSource);
        var showHtml = showTemplate(show);

        $(columnDump).append(showHtml);
      };

      $('.showColumn').append('<div class="clearFix"></div>');

      $('.start-700').css("top","140px");
      $('.start-700').css("height", "60px");
      $('.start-1600').css("top","680px");
    });
  </script>
  <script type="text/javascript" src="javascripts/lib/less-1.4.1.min.js"></script>
</head>
<body>
<div id="contentContainer" class="span-16">
  <div id="titleBox"><h1>CJSR 88.5 FM - Program Schedule</h1></div>
  <span class="clearFix"></span>

  <div class="timestrip span-1 column" id="left-times">
    <div class="dayHeader"></div>
  </div>
  <div id="days-box">

  </div>
  <div class="timestrip span-1 column" id="right-times">
    <div class="dayHeader"></div>
  </div>

</div>
<span class="clearFix"></span>



<!-- TEMPLATES START -->
<script id="header-template" type="text/x-handlebars-template">
  <div class=
</script>

<script id="day-template" type="text/x-handlebars-template">
  <div class="day span-2 column">
    <div class="dayHeader"><strong>{{fullDay}}</strong></div>
    <div class="showColumn" id="{{theDay}}">

    </div>
  </div>
</script>

<script id="show-template" type="text/x-handlebars-template">
  <span class="show start-{{start}} end-{{end}}" id="show-{{id}}">
    <span>{{{name}}}</span>
  </span>
</script>

<!-- TEMPLATES END -->

<script type="text/javascript" src="javascripts/lib/bootstrap.min.js"></script>

</body>
</html>